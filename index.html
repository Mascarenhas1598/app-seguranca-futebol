<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>App Seguran√ßa em Eventos</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
  
  <!-- Tela de Login -->
  <div id="login" class="max-w-md mx-auto mt-20 bg-white p-8 rounded-xl shadow-md">
    <img id="logoEmpresa" src="./logo_nm_engenharia.jpg" alt="Logo NM Engenharia" class="mx-auto mb-6 w-40">
    <h2 class="text-2xl font-bold text-center mb-4">Acesso Restrito</h2>
    <label for="usuario" class="block font-semibold">Usu√°rio</label>
    <input type="text" id="usuario" class="w-full p-2 border border-gray-300 rounded mb-4">
    <label for="senha" class="block font-semibold">Senha</label>
    <input type="password" id="senha" class="w-full p-2 border border-gray-300 rounded mb-6">
    <button id="entrar" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 w-full">Entrar</button>
  </div>
  
  <!-- Tela Principal do App -->
  <div id="app" class="hidden max-w-6xl mx-auto p-6 space-y-10">
    <img src="./logo_nm_engenharia.jpg" alt="Logo NM Engenharia" class="mx-auto mb-6 w-40">

  <div id="app" class="hidden max-w-6xl mx-auto p-6 space-y-10">
        
  <img id="logoEmpresa" src="./logo_nm_engenharia.jpg" alt="Logo NM Engenharia" class="mx-auto mb-6 w-40">
    <!-- Ajuda Geral -->
    <section class="bg-yellow-100 border-l-4 border-yellow-500 p-4 rounded">
      <h2 class="text-lg font-bold mb-2 text-yellow-800">Ajuda Geral</h2>
      <ul class="list-disc list-inside text-sm text-yellow-700">
        <li>Preencha os campos obrigat√≥rios de forma clara e objetiva.</li>
        <li>Utilize os valores entre 0 e 1 nas an√°lises conforme a legenda apresentada.</li>
        <li>Fa√ßa o upload de fotos com descri√ß√£o detalhada em cada fase do evento.</li>
        <li>Registre apenas ocorr√™ncias reais, com dados verificados.</li>
        <li>Use a previs√£o de risco com IA como suporte √† tomada de decis√£o.</li>
        <li>Ao final, utilize a fun√ß√£o de exportar para gerar seu relat√≥rio em PDF.</li>
      </ul>
    </section>

    <!-- Ajuda Geral -->
    <section class="bg-yellow-100 border-l-4 border-yellow-500 p-4 rounded">
      <h2 class="text-lg font-bold mb-2 text-yellow-800">Ajuda Geral</h2>
      <ul class="list-disc list-inside text-sm text-yellow-700">
        <li>Preencha os campos obrigat√≥rios de forma clara e objetiva.</li>
        <li>Utilize os valores entre 0 e 1 nas an√°lises conforme a legenda apresentada.</li>
        <li>Fa√ßa o upload de fotos com descri√ß√£o detalhada em cada fase do evento.</li>
        <li>Registre apenas ocorr√™ncias reais, com dados verificados.</li>
        <li>Use a previs√£o de risco com IA como suporte √† tomada de decis√£o.</li>
        <li>Ao final, utilize a fun√ß√£o de exportar para gerar seu relat√≥rio em PDF.</li>
      </ul>
    </section>

    <!-- Cadastro de Partida -->
    <section class="bg-white p-6 rounded shadow">
      <h2 class="text-xl font-bold mb-4">Cadastro da Partida</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block font-semibold">Data</label>
          <input type="date" class="w-full p-2 border rounded">
        </div>
        <div>
          <label class="block font-semibold">Hor√°rio</label>
          <input type="time" class="w-full p-2 border rounded">
        </div>
        <div class="md:col-span-2">
          <label class="block font-semibold">Equipes Envolvidas</label>
          <input type="text" id="equipesEnvolvidas" class="w-full p-2 border rounded">
        </div>
        <div>
          <label class="block font-semibold">Local de Interesse</label>
          <input type="text" class="w-full p-2 border rounded">
        </div>
        <div>
          <label class="block font-semibold">Capacidade Habilitada do Local</label>
          <input type="number" class="w-full p-2 border rounded">
        </div>
      </div>
    </section>

<!-- An√°lise de Risco -->
<section class="bg-white p-6 rounded shadow">
  <div class="mb-4 p-4 bg-blue-50 border-l-4 border-blue-400 text-sm text-blue-700">
    <p><strong>Legenda dos Campos "0 a 1":</strong></p>
    <ul class="list-disc list-inside">
      <li><strong>0</strong> = Condi√ß√£o ideal ou risco nulo</li>
      <li><strong>0.5</strong> = Situa√ß√£o intermedi√°ria ou risco moderado</li>
      <li><strong>1</strong> = Condi√ß√£o cr√≠tica ou alto risco</li>
    </ul>
  </div>
  <h2 class="text-xl font-bold mb-4">An√°lise de Risco</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
  <div>
    <label class="block font-semibold">Expectativa de P√∫blico</label>
    <input type="number" id="fatorPublico" class="w-full p-2 border rounded" placeholder="Ex: 10000">
  </div>
    <div>
      <label class="block font-semibold">N√≠vel de Treinamento da Equipe de Seguran√ßa</label>
      <input type="number" id="treinamentoSeguranca" class="w-full p-2 border rounded" placeholder="0 a 1">
    </div>
    <div>
      <label class="block font-semibold">Rivalidade entre as torcidas</label>
      <input type="number" id="Rivalidadetorcidas" class="w-full p-2 border rounded" placeholder="0 a 1">
    </div>
    <div>
      <label class="block font-semibold">Efici√™ncia dos Checkpoints</label>
      <input type="number" id="eficienciaCheckpoints" class="w-full p-2 border rounded" placeholder="0 a 1">
    </div>
    <div>
      <label class="block font-semibold">Condi√ß√£o das Vias de Acesso</label>
      <input type="number" id="condicaoVias" class="w-full p-2 border rounded" placeholder="0 a 1">
    </div>
    <div>
      <label class="block font-semibold">Fase da competicao</label>
      <input type="number" id="Fasecompeticao" class="w-full p-2 border rounded" placeholder="0 a 1">
    </div>
    <div>
      <label class="block font-semibold">Historico de itens proibidos torcida visitante conflitiva</label>
      <input type="number" id="itensproibidostorcida" class="w-full p-2 border rounded" placeholder="0 a 1">
    </div>
    <div>
      <label class="block font-semibold">Dia da Semana (0=Semana, 1=Domingo ou feriado)</label>
      <input type="number" id="diaSemana" class="w-full p-2 border rounded" placeholder="0 a 1">
    </div>
    <div>
      <label class="block font-semibold">Hist√≥rico Emocional do Confronto</label>
      <input type="number" id="historicoEmocional" class="w-full p-2 border rounded" placeholder="0 a 1">
    </div>
    <div>
      <label class="block font-semibold">Proximidade entre as torcidas</label>
      <input type="number" id="Proximidadetorcidas" class="w-full p-2 border rounded" placeholder="0 a 1">
    </div>
    <div>
      <label class="block font-semibold">Ativacoes Clube Mandante</label>
      <input type="number" id="Ativacoes" class="w-full p-2 border rounded" placeholder="0 a 1">
    </div>
  </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block font-semibold">Efetivo Empregado (1 seguran√ßa a cada 100 pessoas)</label>
<input type="number" id="fatorEfetivo" class="w-full p-2 border rounded" placeholder="Ex: 50">
        </div>
        <div>
          <label class="block font-semibold">Sistema de Monitoramento</label>
          <input type="number" id="monitoramento" class="w-full p-2 border rounded">
        </div>
        <div>
          <label class="block font-semibold">Condicoes do clima</label>
          <input type="number" id="clima" class="w-full p-2 border rounded" placeholder="0 a 1">
        </div>
        <div>
          <label class="block font-semibold">Escala de Risco das autoridades Policiais</label>
          <input type="number" id="Risco" class="w-full p-2 border rounded" placeholder="0 a 1">
        </div>
        <div>
          <label class="block font-semibold">Torcida Visitante conflitiva</label>
          <input type="number" id="visitante" class="w-full p-2 border rounded" placeholder="0 a 1">
        </div>
        <div>
          <label class="block font-semibold">Historico de conflitos em partidas anteriores</label>
          <input type="number" id="conflitos" class="w-full p-2 border rounded" placeholder="0 a 1">
        </div>
        <div>
          <label class="block font-semibold">tempo de resposta policial</label>
          <input type="number" id="respostapolicial" class="w-full p-2 border rounded" placeholder="0 a 1">
        </div>
      </div>
      <button onclick="preverRiscoIA()" class="mt-6 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">Prever Risco com IA</button>
      <p id="resultadoIA" class="mt-4 font-bold"></p>
    <section class="bg-white p-6 rounded shadow">
  <h2 class="text-xl font-bold mb-4">Impacto Visual do Risco</h2>
  <canvas id="graficoImpacto" height="120"></canvas>
</section>
<section class="bg-white p-6 rounded shadow">
  
   <!-- Relat√≥rio Fotogr√°fico -->
    <section class="bg-white p-6 rounded shadow">
      <h2 class="text-xl font-bold mb-4">Relat√≥rio Fotogr√°fico</h2>
      <div class="mb-4 p-4 bg-green-50 border-l-4 border-green-400 text-sm text-green-700">
        <p><strong>Instru√ß√µes:</strong> Envie at√© 5 fotos por fase do evento. Cada imagem deve ter uma descri√ß√£o clara do que est√° sendo registrado.</p>
      </div>
      <div id="fasesContainer" class="space-y-8">
        <div class="fase-fotografica" data-fase="Montagem">
          <h3 class="text-lg font-semibold mb-2">Montagem</h3>
          <input type="file" accept="image/*" multiple onchange="atualizarFotos(this, 'Montagem')" class="w-full p-2 border rounded">
          <div id="previewMontagem" class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-2"></div>
        </div>
        <div class="fase-fotografica" data-fase="Entrada">
          <h3 class="text-lg font-semibold mb-2">Entrada</h3>
          <input type="file" accept="image/*" multiple onchange="atualizarFotos(this, 'Entrada')" class="w-full p-2 border rounded">
          <div id="previewEntrada" class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-2"></div>
        </div>
        <div class="fase-fotografica" data-fase="Jogo">
          <h3 class="text-lg font-semibold mb-2">Jogo</h3>
          <input type="file" accept="image/*" multiple onchange="atualizarFotos(this, 'Jogo')" class="w-full p-2 border rounded">
          <div id="previewJogo" class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-2"></div>
        </div>
        <div class="fase-fotografica" data-fase="Evacua√ß√£o">
          <h3 class="text-lg font-semibold mb-2">Evacua√ß√£o</h3>
          <input type="file" accept="image/*" multiple onchange="atualizarFotos(this, 'Evacua√ß√£o')" class="w-full p-2 border rounded">
          <div id="previewEvacua√ß√£o" class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-2"></div>
        </div>
        <div class="fase-fotografica" data-fase="Fechamento">
          <h3 class="text-lg font-semibold mb-2">Fechamento</h3>
          <input type="file" accept="image/*" multiple onchange="atualizarFotos(this, 'Fechamento')" class="w-full p-2 border rounded">
          <div id="previewFechamento" class="grid grid-cols-2 md:grid-cols-3 gap-4 mt-2"></div>
        </div>
      </div>
    </section>
  </div>
  
<script>
  const limiteFotosPorFase = 5;
  const fotosPorFase = {
    Montagem: [],
    Entrada: [],
    Jogo: [],
    Evacua√ß√£o: [],
    Fechamento: []
    
  };
  function atualizarFotos(input, fase) {
    const previewId = `preview${fase}`;
    const previewContainer = document.getElementById(previewId);
    const novosArquivos = Array.from(input.files);
    const arquivosAtuais = fotosPorFase[fase];

    for (let i = 0; i < novosArquivos.length && arquivosAtuais.length < limiteFotosPorFase; i++) {
      arquivosAtuais.push(novosArquivos[i]);
    }

    previewContainer.innerHTML = '';
    arquivosAtuais.forEach(file => {
      const reader = new FileReader();
      reader.onload = function (e) {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.alt = file.name;
        img.className = 'w-full h-32 object-cover border rounded shadow';
        previewContainer.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  }
  
</script>
    <!-- Registro de Ocorr√™ncias -->
    <section class="bg-white p-6 rounded shadow">
      <h2 class="text-xl font-bold mb-4">Registro de Ocorr√™ncias</h2>
      <div class="mb-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 text-sm text-yellow-700">
        <p><strong>Orienta√ß√£o:</strong> descreva apenas ocorr√™ncias reais, com o m√°ximo de detalhes poss√≠veis (local, hor√°rio, tipo e consequ√™ncias).</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block font-semibold">Tipo de Ocorr√™ncia</label>
          <input type="text" class="w-full p-2 border rounded">
        </div>
        <div>
          <label class="block font-semibold">Local</label>
          <input type="text" class="w-full p-2 border rounded">
        </div>
        <div>
          <label class="block font-semibold">Hor√°rio</label>
          <input type="time" class="w-full p-2 border rounded">
        </div>
        <div class="md:col-span-2">
          <label class="block font-semibold">Descri√ß√£o</label>
          <textarea class="w-full p-2 border rounded"></textarea>
        </div>
      </div>
    </section>

    <!-- Exportar Relat√≥rio -->
    <section class="bg-white p-6 rounded shadow">
      <h2 class="text-xl font-bold mb-4">Exportar Relat√≥rio</h2>
      <button onclick="window.print()" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">Exportar para PDF</button>
   </section>
  </div>
  
<script>
    // Garantir que apenas a tela de login seja exibida inicialmente
    document.addEventListener("DOMContentLoaded", function () {
      document.getElementById("login").style.display = "block"; // Exibe a tela de login
      document.getElementById("app").style.display = "none";   // Oculta o restante
    });

    // Evento para autentica√ß√£o e transi√ß√£o de telas
    document.getElementById("entrar").addEventListener("click", function () {
      const usuario = document.getElementById("usuario").value.trim();
      const senha = document.getElementById("senha").value.trim();

      // Simula√ß√£o de autentica√ß√£o
      if (usuario === "Admin" && senha === "12345#") {
        document.getElementById("login").style.display = "none"; // Oculta a tela de login
        document.getElementById("app").style.display = "block"; // Exibe a tela principal
      } else {
        alert("Usu√°rio ou senha inv√°lidos! Tente novamente.");
      }
    });
  </script>
function preverRiscoIA() {
  const publico = parseFloat(document.getElementById('fatorPublico')?.value || 0);
  const efetivo = parseFloat(document.getElementById('fatorEfetivo')?.value || 0);
  const ocorrencias = parseFloat(document.getElementById('fatorOcorrencias')?.value || 0);
  const clima = parseFloat(document.getElementById('clima')?.value || 0);
  const rivalidade = parseFloat(document.getElementById('rivalidade')?.value || 0);
  const visitante = parseFloat(document.getElementById('visitante')?.value || 0);
  const infra = parseFloat(document.getElementById('infraestrutura')?.value || 0);
  const evacuacao = parseFloat(document.getElementById('evacuacao')?.value || 0);
  const tempoResposta = parseFloat(document.getElementById('tempoResposta')?.value || 0);
  const capacidadeTransporte = parseFloat(document.getElementById('capacidadeTransporte')?.value || 0);
  const coberturaCameras = parseFloat(document.getElementById('coberturaCameras')?.value || 0);
  const planoContingencia = parseFloat(document.getElementById('planoContingencia')?.value || 0);
  const equipes = document.getElementById('equipesEnvolvidas')?.value.toLowerCase() || "";

  const pesos = {
    publico: 0.4,
    efetivo: -0.3,
    ocorrencias: 0.25,
    clima: 0.2,
    rivalidade: 0.3,
    visitante: 0.2,
    infra: 0.2,
    evacuacao: 0.2,
    tempoResposta: 0.2,
    capacidadeTransporte: 0.2,
    coberturaCameras: 0.2,
    planoContingencia: 0.2,
    portoesAbertos: 0.2,
    bebidaAlcoolica: 0.3,
    tempoEvento: 0.2,
    setoresMistos: 0.3,
    conflitosHistoricos: 0.3,
    alertaSeguranca: 0.4,
    redesSociais: 0.3,
    eventoConcomitante: 0.2,
    distanciaTorcidas: 0.2,
    rivalExtra: 0.5
  };

  let riscoEstrutural = (
    parseFloat(document.getElementById('infraestrutura')?.value || 0) +
    parseFloat(document.getElementById('condicaoVias')?.value || 0) +
    parseFloat(document.getElementById('iluminacaoPublica')?.value || 0) +
    parseFloat(document.getElementById('distanciaApoioPolicial')?.value || 0)
) / 4;

let publicoEstimado = parseFloat(document.getElementById('fatorPublico')?.value || 0);
let efetivoEmpregado = parseFloat(document.getElementById('fatorEfetivo')?.value || 0);
let razaoEfetivo = (publicoEstimado > 0) ? efetivoEmpregado / (publicoEstimado / 100) : 1;
let riscoEfetivo = 1 - Math.min(razaoEfetivo, 1);

let riscoOperacional = (
  riscoEfetivo +
    parseFloat(document.getElementById('evacuacao')?.value || 0) +
    parseFloat(document.getElementById('tempoInspecao')?.value || 0) +
    parseFloat(document.getElementById('eficienciaCheckpoints')?.value || 0) +
    parseFloat(document.getElementById('clima')?.value || 0)
) / 5;

let riscoComportamental = (
    parseFloat(document.getElementById('rivalidade')?.value || 0) +
    parseFloat(document.getElementById('visitante')?.value || 0) +
    parseFloat(document.getElementById('monitoramentoGrupos')?.value || 0) +
    parseFloat(document.getElementById('historicoEmocional')?.value || 0) +
    parseFloat(document.getElementById('mandadosPendentes')?.value || 0) +
    parseFloat(document.getElementById('fatorOcorrencias')?.value || 0)
) / 6;

let riscoContextual = (
    parseFloat(document.getElementById('diaSemana')?.value || 0) +
    parseFloat(document.getElementById('tempoResposta')?.value || 0)
) / 2;

let riscoFinal = (0.3 * riscoEstrutural) + (0.3 * riscoOperacional) + (0.3 * riscoComportamental) + (0.1 * riscoContextual);

  let total = riscoEstrutural + riscoOperacional + riscoComportamental + riscoContextual;
  let impactoEstrutural = ((riscoEstrutural / total) * 100).toFixed(1);
  let impactoOperacional = ((riscoOperacional / total) * 100).toFixed(1);
  let impactoComportamental = ((riscoComportamental / total) * 100).toFixed(1);
  let impactoContextual = ((riscoContextual / total) * 100).toFixed(1);
const prob = 1 / (1 + Math.exp(-2 * (riscoFinal - 0.5)));
  let resultado = "Baixo";
  let cor = "#4CAF50";
  if (prob >= 0.7) {
    resultado = "Alto";
    cor = "#F44336";
  } else if (prob >= 0.4) {
    resultado = "Moderado";
    cor = "#FFC107";
  }

  const el = document.getElementById("resultadoIA");
  el.innerText = `Previs√£o de Risco com IA: ${resultado} (Prob: ${(prob * 100).toFixed(1)}%)`;
  el.style.color = "white";
  el.style.backgroundColor = cor;
  el.style.padding = "10px";
  el.style.borderRadius = "6px";
  el.innerHTML += `<br><small style='display:block; margin-top:10px;'>Impacto por categoria:<br>üîµ Estrutural: ${impactoEstrutural}%<br>üü¢ Operacional: ${impactoOperacional}%<br>üü† Comportamental: ${impactoComportamental}%<br>üî¥ Contextual: ${impactoContextual}%</small>`;
  
  // Sugest√µes autom√°ticas de mitiga√ß√£o
  let sugestoes = [];
  if (prob >= 0.7) {
    sugestoes.push("‚úÖ Refor√ßar efetivo policial e seguran√ßa privada");
    sugestoes.push("‚úÖ Implementar plano de evacua√ß√£o de emerg√™ncia refor√ßado");
    sugestoes.push("‚úÖ Intensificar revista pessoal e controle de acesso");
  } else if (prob >= 0.4) {
    sugestoes.push("üîç Revisar os pontos de controle e checkpoints");
    sugestoes.push("üîç Aumentar o monitoramento de grupos organizados");
  } else {
    sugestoes.push("‚úîÔ∏è Manter planejamento padr√£o com monitoramento preventivo");
  }
  el.innerHTML += `<br><br><strong>A√ß√µes Mitigadoras Sugeridas:</strong><ul class='list-disc list-inside text-sm mt-2'>` + sugestoes.map(s => `<li>${s}</li>`).join('') + `</ul>`;

  desenharGraficoImpacto(el, impactoEstrutural, impactoOperacional, impactoComportamental, impactoContextual);
}

function desenharGraficoImpacto(e, estrutural, operacional, comportamental, contextual) {
  const ctx = document.getElementById('graficoImpacto')?.getContext('2d');
  if (!ctx) return;
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Estrutural', 'Operacional', 'Comportamental', 'Contextual'],
      datasets: [{
        label: 'Impacto (%)',
        data: [estrutural, operacional, comportamental, contextual],
        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444']
      }]
    },
    options: {
      responsive: true,
      scales: { y: { beginAtZero: true, max: 100 } }
    }
  });
}
const inputFotos = document.querySelector('input[type="file"]');
const previewContainer = document.getElementById("previewFotos");
inputFotos.addEventListener('change', function () {
  previewContainer.innerHTML = '';
  [...this.files].forEach(file => {
    const reader = new FileReader();
    reader.onload = function (e) {
      const img = document.createElement('img');
      img.src = e.target.result;
      img.alt = file.name;
      img.className = 'w-full h-32 object-cover border rounded shadow';
      previewContainer.appendChild(img);
    };
    reader.readAsDataURL(file);
  });
});
</script>
</body>
</html>
