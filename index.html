<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>App Segurança em Eventos</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">

  <!-- Tela de Login -->
  <div id="login" class="max-w-md mx-auto mt-20 bg-white p-8 rounded-xl shadow-md">
    <img id="logoEmpresa" src="./logo_nm_engenharia.jpg" alt="Logo NM Engenharia" class="mx-auto mb-6 w-40">
    <h2 class="text-2xl font-bold text-center mb-4">Acesso Restrito</h2>
    <label for="usuario" class="block font-semibold">Usuário</label>
    <input type="text" id="usuario" class="w-full p-2 border border-gray-300 rounded mb-4">
    <label for="senha" class="block font-semibold">Senha</label>
    <input type="password" id="senha" class="w-full p-2 border border-gray-300 rounded mb-6">
    <button id="entrar" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 w-full">Entrar</button>
  </div>

  <!-- Aplicativo -->
  <div id="app" class="hidden max-w-6xl mx-auto p-6 space-y-10">

    <!-- Seção Análise de Risco -->
    <section class="bg-white p-6 rounded shadow">
      <h2 class="text-xl font-bold mb-4">Análise de Risco</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block font-semibold">Expectativa de Público</label>
          <input type="number" id="fatorPublico" class="w-full p-2 border rounded" placeholder="Ex: 10000">
        </div>
        <div>
          <label class="block font-semibold">Efetivo Empregado (1 segurança a cada 100 pessoas)</label>
          <input type="number" id="fatorEfetivo" class="w-full p-2 border rounded" placeholder="Ex: 50">
        </div>
        <div>
          <label class="block font-semibold">Número de Ocorrências</label>
          <input type="number" id="fatorOcorrencias" class="w-full p-2 border rounded">
        </div>
        <div>
          <label class="block font-semibold">Clima</label>
          <input type="number" id="clima" class="w-full p-2 border rounded" placeholder="0 a 1">
        </div>
      </div>
      <button onclick="preverRiscoIA()" class="mt-6 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">Prever Risco com IA</button>
      <p id="resultadoIA" class="mt-4 font-bold"></p>
      <canvas id="graficoImpacto" height="120"></canvas>
    </section>

    <!-- Seção Relatório Fotográfico (já existente) -->
    <section class="bg-white p-6 rounded shadow">
      <h2 class="text-xl font-bold mb-4">Relatório Fotográfico</h2>
      <div class="mb-4 p-4 bg-green-50 border-l-4 border-green-400 text-sm text-green-700">
        <p><strong>Instruções:</strong> envie até 5 fotos por fase do evento. Cada imagem pode conter uma descrição.</p>
      </div>

      <label class="block font-semibold">Fase do Evento</label>
      <select id="faseEvento" class="w-full p-2 border rounded mb-4">
        <option value="Montagem">Montagem</option>
        <option value="Entrada">Entrada</option>
        <option value="Jogo">Jogo</option>
        <option value="Evacuacao">Evacuação</option>
        <option value="Fechamento">Fechamento</option>
      </select>

      <label class="block font-semibold">Upload de Fotos</label>
      <input id="uploadFotos" type="file" accept="image/*" multiple class="w-full p-2 border rounded mb-4">
      <small class="text-gray-500 block mb-4">Máximo 5 fotos por fase</small>

      <div id="galeriaFotos" class="space-y-6"></div>
    </section>

    <!-- Registro de Ocorrências -->
    <section class="bg-white p-6 rounded shadow">
      <h2 class="text-xl font-bold mb-4">Registro de Ocorrências</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block font-semibold">Tipo de Ocorrência</label>
          <input type="text" class="w-full p-2 border rounded">
        </div>
        <div>
          <label class="block font-semibold">Local</label>
          <input type="text" class="w-full p-2 border rounded">
        </div>
        <div>
          <label class="block font-semibold">Horário</label>
          <input type="time" class="w-full p-2 border rounded">
        </div>
        <div class="md:col-span-2">
          <label class="block font-semibold">Descrição</label>
          <textarea class="w-full p-2 border rounded"></textarea>
        </div>
      </div>
    </section>

    <!-- Exportar Relatório -->
    <section class="bg-white p-6 rounded shadow">
      <h2 class="text-xl font-bold mb-4">Exportar Relatório</h2>
      <button onclick="window.print()" class="bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">Exportar para PDF</button>
    </section>

  </div>

  <script>
    document.getElementById("entrar").addEventListener("click", function () {
      const usuario = document.getElementById("usuario").value;
      const senha = document.getElementById("senha").value;
      if (usuario === "admin" && senha === "123") {
        document.getElementById("login").style.display = "none";
        document.getElementById("app").classList.remove("hidden");
      } else {
        alert("Usuário ou senha inválidos.");
      }
    });

    const galeriaFotos = document.getElementById("galeriaFotos");
    const uploadFotos = document.getElementById("uploadFotos");
    const faseEvento = document.getElementById("faseEvento");
    const fotosPorFase = { Montagem: [], Entrada: [], Jogo: [], Evacuacao: [], Fechamento: [] };

    uploadFotos.addEventListener("change", function () {
      const fase = faseEvento.value;
      const files = [...this.files];
      if (fotosPorFase[fase].length + files.length > 5) {
        alert("Você só pode adicionar até 5 fotos por fase.");
        return;
      }
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = function (e) {
          const img = new Image();
          img.src = e.target.result;
          img.className = "w-full h-32 object-cover border rounded";
          const descricao = document.createElement("input");
          descricao.type = "text";
          descricao.placeholder = "Descrição da foto";
          descricao.className = "w-full p-1 border border-gray-300 rounded text-sm mt-1";
          const container = document.createElement("div");
          container.className = "mb-2";
          container.appendChild(img);
          container.appendChild(descricao);
          fotosPorFase[fase].push(container);
          renderGaleria();
        };
        reader.readAsDataURL(file);
      });
      this.value = "";
    });

    function renderGaleria() {
      galeriaFotos.innerHTML = "";
      for (const fase in fotosPorFase) {
        if (fotosPorFase[fase].length > 0) {
          const titulo = document.createElement("h3");
          titulo.className = "text-lg font-semibold mt-4 mb-2";
          titulo.textContent = `Fase: ${fase}`;
          galeriaFotos.appendChild(titulo);
          const grid = document.createElement("div");
          grid.className = "grid grid-cols-2 md:grid-cols-3 gap-4";
          fotosPorFase[fase].forEach(container => grid.appendChild(container));
          galeriaFotos.appendChild(grid);
        }
      }
    }

    function preverRiscoIA() {
      const publico = parseFloat(document.getElementById('fatorPublico')?.value || 0);
      const efetivo = parseFloat(document.getElementById('fatorEfetivo')?.value || 0);
      const ocorrencias = parseFloat(document.getElementById('fatorOcorrencias')?.value || 0);
      const clima = parseFloat(document.getElementById('clima')?.value || 0);

      const risco = (publico / 10000 + ocorrencias + (1 - efetivo / (publico / 100 || 1)) + clima) / 4;
      let resultado = "Baixo";
      let cor = "#4CAF50";
      if (risco >= 0.7) { resultado = "Alto"; cor = "#F44336"; }
      else if (risco >= 0.4) { resultado = "Moderado"; cor = "#FFC107"; }

      const el = document.getElementById("resultadoIA");
      el.innerText = `Previsão de Risco com IA: ${resultado} (Score: ${(risco * 100).toFixed(1)}%)`;
      el.style.color = "white";
      el.style.backgroundColor = cor;
      el.style.padding = "10px";
      el.style.borderRadius = "6px";

      const ctx = document.getElementById('graficoImpacto').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Público', 'Efetivo', 'Ocorrências', 'Clima'],
          datasets: [{
            label: 'Fatores de Risco',
            data: [publico / 10000, 1 - efetivo / (publico / 100 || 1), ocorrencias, clima],
            backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444']
          }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true, max: 1 } } }
      });
    }
  </script>
</body>
</html>

